# ملف: .github/workflows/build.yml
name: Build SigmaStealth Mod

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout empty repository
        uses: actions/checkout@v4
      
      - name: Set up JDK 8
        uses: actions/setup-java@v4
        with:
          java-version: '8'
          distribution: 'temurin'
      
      - name: Create ENTIRE Mod from Scratch
        run: |
          # إنشاء كل الملفات من الصفر في ريبو فارغ
          mkdir -p src/main/java/com/sigmaxox/sigmasteralth
          mkdir -p src/main/resources/assets/sigmasteralth
          
          # 1. إنشاء fabric.mod.json
          cat > src/main/resources/fabric.mod.json << 'EOF'
          {
            "schemaVersion": 1,
            "id": "sigmasteralth",
            "version": "1.0.0",
            "name": "SigmaStealth",
            "description": "Client-side stealth mod by SIGMAxox",
            "authors": ["SIGMAxox"],
            "contact": {},
            "license": "MIT",
            "icon": "assets/sigmasteralth/icon.png",
            "environment": "client",
            "entrypoints": {
              "client": [
                "com.sigmaxox.sigmasteralth.SigmaStealthMod"
              ]
            },
            "depends": {
              "fabricloader": ">=0.11.3",
              "minecraft": "1.16.5"
            }
          }
          EOF
          
          # 2. إنشاء الملف الرئيسي (بدون Fabric API)
          cat > src/main/java/com/sigmaxox/sigmasteralth/SigmaStealthMod.java << 'EOF'
          package com.sigmaxox.sigmasteralth;
          
          import net.fabricmc.api.ClientModInitializer;
          import net.minecraft.client.MinecraftClient;
          import net.minecraft.client.option.KeyBinding;
          import net.minecraft.client.util.InputUtil;
          import net.minecraft.text.Text;
          import org.lwjgl.glfw.GLFW;
          
          public class SigmaStealthMod implements ClientModInitializer {
              private static KeyBinding stealthKey;
              public static boolean stealthEnabled = false;
              
              @Override
              public void onInitializeClient() {
                  // تسجيل مفتاح ALT يدوياً بدون Fabric API
                  stealthKey = new KeyBinding(
                      "key.sigmasteralth.stealth",
                      InputUtil.Type.KEYSYM,
                      GLFW.GLFW_KEY_LEFT_ALT,
                      "category.sigmasteralth.general"
                  );
                  
                  net.minecraft.client.option.KeyBindingHelper.registerKeyBinding(stealthKey);
                  
                  // نظام التحديث البديل
                  new Thread(() -> {
                      while (true) {
                          try {
                              if (stealthEnabled && MinecraftClient.getInstance().player != null) {
                                  sendFakePosition();
                              }
                              Thread.sleep(50); // 20 مرة في الثانية
                          } catch (Exception e) {}
                      }
                  }).start();
              }
              
              public static void onClientTick() {
                  if (stealthKey.wasPressed()) {
                      stealthEnabled = !stealthEnabled;
                      MinecraftClient client = MinecraftClient.getInstance();
                      if (client.player != null) {
                          if (stealthEnabled) {
                              client.player.sendMessage(Text.of("§6SigmaStealth §a- ON"), true);
                          } else {
                              client.player.sendMessage(Text.of("§6SigmaStealth §c- OFF"), true);
                          }
                      }
                  }
              }
              
              private static void sendFakePosition() {
                  MinecraftClient client = MinecraftClient.getInstance();
                  if (client.getNetworkHandler() != null && client.player != null) {
                      // إرسال موقع وهمي
                      client.getNetworkHandler().sendPacket(new net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket.PositionAndOnGround(
                          client.player.getX(), client.player.getY(), client.player.getZ(), client.player.isOnGround()
                      ));
                  }
              }
          }
          EOF
          
          # 3. إنشاء KeyBindingHelper (بديل لـ Fabric API)
          cat > src/main/java/com/sigmaxox/sigmasteralth/KeyBindingHelper.java << 'EOF'
          package com.sigmaxox.sigmasteralth;
          
          import net.minecraft.client.option.KeyBinding;
          import net.minecraft.client.util.InputUtil;
          import java.util.ArrayList;
          import java.util.List;
          
          public class KeyBindingHelper {
              private static final List<KeyBinding> customKeys = new ArrayList<>();
              
              public static KeyBinding registerKeyBinding(KeyBinding binding) {
                  customKeys.add(binding);
                  return binding;
              }
              
              public static List<KeyBinding> getCustomKeys() {
                  return customKeys;
              }
          }
          EOF
          
          # 4. إنشاء build.gradle بإصدارات مثبتة
          cat > build.gradle << 'EOF'
          plugins {
              id 'fabric-loom' version '0.10-SNAPSHOT'
          }
          
          version = "1.0.0"
          group = "com.sigmaxox"
          
          repositories {
              maven { url "https://maven.fabricmc.net/" }
          }
          
          dependencies {
              minecraft "com.mojang:minecraft:1.16.5"
              mappings "net.fabricmc:yarn:1.16.5+build.10:v2"
              modImplementation "net.fabricmc:fabric-loader:0.13.3"
              
              // Fabric API إصدار مثبت ومجرب
              modImplementation "net.fabricmc.fabric-api:fabric-api:0.34.2+1.16"
          }
          
          processResources {
              inputs.property "version", project.version
              filesMatching("fabric.mod.json") {
                  expand "version": project.version
              }
          }
          EOF
          
          # 5. إنشاء settings.gradle
          cat > settings.gradle << 'EOF'
          pluginManagement {
              repositories {
                  maven { url = "https://maven.fabricmc.net/" }
                  gradlePluginPortal()
              }
          }
          rootProject.name = "sigmasteralth"
          EOF
      
      - name: Build with Correct Versions
        run: |
          # استخدام إصدار أقدم من Gradle متوافق مع Loom 0.10
          wget -q https://services.gradle.org/distributions/gradle-7.4.2-bin.zip
          unzip -q gradle-7.4.2-bin.zip
          ./gradle-7.4.2/bin/gradle build --no-daemon --stacktrace
      
      - name: Upload MOD File
        uses: actions/upload-artifact@v4
        with:
          name: SigmaStealth-MOD
          path: build/libs/*.jar
