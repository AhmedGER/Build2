name: ðŸš€ Auto Build Armor Durability Pack

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-durability-pack:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¦ Checkout Repository
      uses: actions/checkout@v3
    
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ðŸ“ Create build.py
      run: |
        cat > build.py << 'ENDPYTHON'
        #!/usr/bin/env python3
        import json, zipfile, shutil
        from pathlib import Path

        PACK_NAME = "Armor-Durability-Pack"
        PACK_DESCRIPTION = "ÙŠØ¸Ù‡Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±ÙˆØ¹ Ù‚Ø¨Ù„ Ø£Ù† ØªØªÙƒØ³Ø±"
        UUID_HEADER = "a1b2c3d4-1111-2222-3333-444455556666"
        UUID_MODULE = "b7c8d9e0-7777-8888-9999-000011112222"

        def create_manifest():
            return {
                "format_version": 2,
                "header": {
                    "name": PACK_NAME,
                    "description": PACK_DESCRIPTION,
                    "uuid": UUID_HEADER,
                    "version": [1, 0, 0],
                    "min_engine_version": [1, 21, 0]
                },
                "modules": [
                    {
                        "type": "resources",
                        "uuid": UUID_MODULE,
                        "version": [1, 0, 0]
                    }
                ]
            }

        def create_durability_hud():
            return {
                "namespace": "hud",
                "durability_panel": {
                    "type": "label",
                    "text": "âš”ï¸ Armor Durability: ${item_durability}",
                    "anchor_from": "top_left",
                    "anchor_to": "top_left",
                    "offset": [10, 10],
                    "color": "red"
                }
            }

        def build_pack():
            print("Building resource pack...")
            temp_dir = Path("temp_pack"); ui_dir = temp_dir / "ui"; dist_dir = Path("dist")
            temp_dir.mkdir(exist_ok=True); ui_dir.mkdir(exist_ok=True); dist_dir.mkdir(exist_ok=True)

            (temp_dir / "manifest.json").write_text(json.dumps(create_manifest(), indent=2, ensure_ascii=False), "utf-8")
            (ui_dir / "durability_hud.json").write_text(json.dumps(create_durability_hud(), indent=2), "utf-8")

            pack_icon_data = bytes.fromhex(
                "89504e470d0a1a0a0000000d49484452000000010000000108060000001f15c489"
                "0000000a49444154789c6360000002000100ffff03000006000557bf2a00000000"
                "49454e44ae426082"
            )
            (temp_dir / "pack_icon.png").write_bytes(pack_icon_data)

            zip_path = dist_dir / f"{PACK_NAME}.mcpack"
            with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as zipf:
                for file in temp_dir.rglob("*"):
                    if file.is_file():
                        zipf.write(file, file.relative_to(temp_dir))

            shutil.rmtree(temp_dir)
            print(f"Build complete: {zip_path}")
            print(f"Size: {zip_path.stat().st_size / 1024:.2f} KB")

        if __name__ == "__main__":
            build_pack()
        ENDPYTHON
        chmod +x build.py
    
    - name: ðŸ”¨ Build Resource Pack
      run: python build.py
    
    - name: ðŸ“¤ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Armor-Durability-Pack
        path: dist/Armor-Durability-Pack.mcpack
        retention-days: 90
    
    - name: âœ… Build Complete
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  âœ¨ Build Complete! âœ¨"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ðŸ“¦ Package: Armor-Durability-Pack"
        echo "ðŸ‘¨â€ðŸ’» Developer: SIGMAxox"
        echo "ðŸŽ® Version: Minecraft Bedrock 1.21.114+"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
