name: ðŸš€ Auto Build Minecraft Chat Hider Pack

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-everything:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¦ Checkout Repository
      uses: actions/checkout@v3
    
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ðŸ“ Create build.py
      run: |
        cat > build.py << 'ENDPYTHON'
        #!/usr/bin/env python3
        import json, zipfile, shutil
        from pathlib import Path

        PACK_NAME = "Chat-Hider-Pack"
        PACK_DESCRIPTION = "ÙŠØ®ÙÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙÙŠ Ù…Ø§ÙŠÙ† ÙƒØ±Ø§ÙØª Ø¨ÙŠØ¯Ø±ÙˆÙƒ"
        UUID_HEADER = "1642f509-51c7-4aec-93f3-fcd57acee38a"
        UUID_MODULE = "27d1ca2d-a89e-4be9-aeef-ff188efa5b04"

        def create_manifest():
            return {
                "format_version": 2,
                "header": {
                    "name": PACK_NAME,
                    "description": PACK_DESCRIPTION,
                    "uuid": UUID_HEADER,
                    "version": [1, 0, 0],
                    "min_engine_version": [1, 21, 0]
                },
                "modules": [
                    {
                        "type": "resources",
                        "uuid": UUID_MODULE,
                        "version": [1, 0, 0]
                    }
                ]
            }

        def create_hud_screen():
            return {
                "namespace": "hud",
                "root_panel": {
                    "modifications": [
                        {"array_name": "controls","operation": "remove","where": {"name": "chat_panel"}}
                    ]
                },
                "hud_content": {
                    "modifications": [
                        {"array_name": "controls","operation": "remove","where": {"name": "chat_panel"}}
                    ]
                }
            }

        def create_chat_screen():
            return {
                "namespace": "chat",
                "chat_screen_content": {"type": "panel","visible": False},
                "chat_text_panel": {"type": "panel","visible": False},
                "chat_background": {"type": "image","visible": False},
                "send_button": {"type": "button","visible": False}
            }

        def build_pack():
            print("Building resource pack...")
            temp_dir = Path("temp_pack"); ui_dir = temp_dir / "ui"; dist_dir = Path("dist")
            temp_dir.mkdir(exist_ok=True); ui_dir.mkdir(exist_ok=True); dist_dir.mkdir(exist_ok=True)

            (temp_dir / "manifest.json").write_text(json.dumps(create_manifest(), indent=2, ensure_ascii=False), "utf-8")
            (ui_dir / "hud_screen.json").write_text(json.dumps(create_hud_screen(), indent=2), "utf-8")
            (ui_dir / "chat_screen.json").write_text(json.dumps(create_chat_screen(), indent=2), "utf-8")

            pack_icon_data = bytes.fromhex("89504e470d0a1a0a0000000d49484452000000010000000108060000001f15c4..."
                                           "0049454e44ae426082")
            (temp_dir / "pack_icon.png").write_bytes(pack_icon_data)

            zip_path = dist_dir / f"{PACK_NAME}.mcpack"
            with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as zipf:
                for file in temp_dir.rglob("*"):
                    if file.is_file():
                        zipf.write(file, file.relative_to(temp_dir))

            shutil.rmtree(temp_dir)
            print(f"Build complete: {zip_path}")
            print(f"Size: {zip_path.stat().st_size / 1024:.2f} KB")

        if __name__ == "__main__":
            build_pack()
        ENDPYTHON
        chmod +x build.py
    
    - name: ðŸ”¨ Build Resource Pack
      run: python build.py
    
    - name: ðŸ“¤ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Chat-Hider-Pack
        path: dist/Chat-Hider-Pack.mcpack
        retention-days: 90
    
    - name: ðŸŽ‰ Create Release
      if: github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ github.run_number }}
        name: "ðŸŽ® Chat-Hider-Pack v${{ github.run_number }}"
        body: |
          ## ðŸš€ Release v${{ github.run_number }}
          - âœ… Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Minecraft Bedrock 1.21.114+
          - âœ… ÙŠØ®ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ù† HUD
          - âœ… ÙŠØ³ØªØ®Ø¯Ù… Modifications API Ø§Ù„Ø±Ø³Ù…ÙŠØ©
          - âœ… Ø³Ù‡Ù„ Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        files: dist/Chat-Hider-Pack.mcpack
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: âœ… Build Complete
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  âœ¨ Build Complete! âœ¨"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ðŸ“¦ Package: Chat-Hider-Pack"
        echo "ðŸ‘¨â€ðŸ’» Developer: SIGMAxox"
        echo "ðŸŽ® Version: Minecraft Bedrock 1.21.114+"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
